% !TeX root = ../../pythonTutorial.tex
\section{Testing}
\label{testing:sec:Testing}
Zum Testen unter Python gibt es mehrere Module die das Testen unterstützen.
Zum einen das Modul \lstinline$doctest$, welches als interaktive Dokumentation Testmuster bereitstellt.
Zum anderen das Modul \lstinline$unittest$, welches den Unittests unter Java mit JUnit sehr ähnelt.
Beide Module ermöglichen Regressionstests.
\subsection*{doctest}
\label{testing:sec:DocTest}
Das Modul \lstinline$doctest$ ermöglicht es, Tests parallel mit dem Programmcode in die selbe Datei zu schreiben.
Dies ist sowohl innerhalb von Funktionen als auch außerhalb möglich.
Hierbei werden die Tests in Kommentarblöcken (\lstinline$"""$) durch die Zeichenfolge \lstinline$>>>$ eingeleitet.
Danach wird die Funktion, die getestet werden soll, mit den gewünschten Testparametern aufgerufen.
Diesem folgt dann entweder das Ergebnis oder eine Fehlerbehandlung im Falle einer zu prüfenden Exception.

Beispiel \ref{tests:lst:SimpleDocTest} \randnotiz{Beispiel} zeigt, wie \lstinline$doctests$ in der Praxis Anwendung finden.
Die Tests werden, sobald der Code ausgeführt, wird ebenfalls ausgeführt. 
Dadurch das die Tests bei dem zu testenden Code stehen wird ein direkter Bezug zwischen beiden hergestellt.
Sollte beim Ausführen kein Test fehlschlagen, kommt es zu keiner Ausgabe durch den Interpreter.
Ist trotzdem eine Ausgabe erwünscht, ist diese mit dem Parameter \lstinline$-v$ (verbose) aktivierbar.

\lstinputlisting[language=Python,lastline=37, label={tests:lst:SimpleDocTest}]{chapters/basics/src/tests/simpleDocTest.py}

Im nachfolgenden Beispiel \ref{tests:lst:SimpleDocTestPrintSuccess} ist die Ausgabe der Tests aus dem oben gezeigten Codebeispiel \ref{tests:lst:SimpleDocTest}, zu sehen.
Der Ablauf, der einzelnen Test, ist jedes Mal gleich.
Zuerst wird der Test, mit den Versuchsparametern ausgegeben und im Anschluss der Erwartungswert gezeigt.
Sollte der Rückgabewert der Funktion dem Erwartungswert entsprechen, wird der Test mit OK beendet.
Gleiches gilt beim Testen auf Exceptions.
Zum Schluss werden die Ergebnisse in einer Auflistung zusammengefasst und nach Zugehörigkeit gruppiert.
Hierbei handelt es sich um einen freien Test und drei innerhalb der Funktion.
Danach gibt es noch eine weitere Zusammenfassung, die die Tests nach Erfolg und Misserfolg gruppiert.
Dies soll dem Anwender ermöglichen, alle Tests mit einem Blick zu erfassen.

\lstinputlisting[language=python,linerange={1-3,40-69}, label={tests:lst:SimpleDocTestPrintSuccess}]{chapters/basics/src/tests/simpleDocTest.py}

Um den Fehlerfall zu betrachten, wurde die Rückgabe der Funktion von \lstinline$x * y$ auf \lstinline$x + y$ geändert.
Dies sorgte sofort für zwei Fehler beim Start des Programms.
Die einzelnen Fehler werden getrennt dargestellt.
Im Unterschied zum Erfolgsfall wird hier die Stelle angegeben, an der der Test steht.
Zusätzlich dazu wird der zurückgegebene Wert angezeigt.
Am Ende erfolgt wieder eine Zusammenfassung.

\lstinputlisting[language=python,linerange={1-3,73-93}, label={tests:lst:SimpleDocTestPrintFailure}]{chapters/basics/src/tests/simpleDocTest.py}

Über \randnotiz{Strukturierung} das Modul \lstinline$doctest$ ist es einerseits möglich, Tests direkt an den Programmcode zu hängen und über den Docstring der Funktion Tests auszuführen.
Diese Tests werden am ende eines Moduls mit \lstinline$doctest.testmod()$ aufgerufen.
Andererseits ist es Möglichkeit über \lstinline$doctest.testfile()$ separate Testdateien als Tests auszuführen.
Es ist also möglich Tests zu einer Modul oder eine Klasse außerhalb der Klasse zu definieren.
Damit der Python Interpreter weiß welches Modul hierbei getestet werden soll muss dies vorher über eine Importanweisung bekannt gemacht werden.
Da sich der Befehl in einem Docstring befindet, muss dieser wie die Funktionsaufrufen über \lstinline$>>>$ eingeleitet werden.
Bei dieser Möglichkeit der Strukturierung ist es darüber hinaus auch möglich, die Tests unabhängig vom Programmcode ablaufen zu lassen.
Hierfür muss wie in Listing \ref{testing:lst:AusfuehrenVonDoctests} das Modul \lstinline$doctest$ gewählt und die Testdatei übergeben werden.
Das Modul erkennt automatisch, dass es in diesem fall \lstinline$doctest.testfile()$ nutzen muss.
\begin{lstlisting}[label=testing:lst:AusfuehrenVonDoctests,language=bash]
    python -m doctest exampleTest.txt
\end{lstlisting}

Die Textdatei für ausgelagerte Testfälle kann die wie folgt aussehen.

\lstinputlisting[label={tests:lst:docTestExtern}]{chapters/basics/src/tests/doctest.txt}

\tip{Grundsätzlich ist die Menge des Texts, der zusätzlich zum eigentlichen Test in einer ausgelagerten doctest-Datei steht, beliebig.
Zu beachten ist lediglich die Importanweisung sowie die Notation mit \lstinline$>>>$ zum Aufrufen der Funktion und deren Ausgabe im Anschluss.}