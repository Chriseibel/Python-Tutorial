% !TeX root = ../../pythonTutorial.tex

\section{Maschinelles Lernen in Python}\label{maschinelleslernen:einleitung}
Das Themengebiet des maschinellen Lernens kann verschiedene Komplexitätslevel erreichen. Grundlegend ist das mathematische Verständnis über die verschiedenen im maschinellen lernen eingesetzten Algorithmen. Diese werden in diesem Tutorial nicht beschrieben. \\
Sind die Algorithmen bekannt und sollen nun mittels Python angewendet werden, sollte zu Beginn mit einem kleinen Projekt gestartet werden. Hierbei ist es sinnvoll sich bereits am Anfang eine Vorgehensweise zu überlegen, wie auch bei allen anderen Projekten. Python bietet im Bereich des maschinellen Lernens viele unterschiedliche Möglichkeiten an, sodass bereits frühzeitig der Aufbau des Projekts entschieden werden sollte. Grob kann ein Projekt in fünf Schritte aufgeteilt werden, anhand derer später das Ergebnis verifiziert werden kann. \\

\begin{enumerate}
\item zu lösendes Problem definieren
\item Daten verstehen und vorbereiten
\item mögliche Algorithmen evaluieren
\item Ergebnisse verbessern
\item Ergebnisse darstellen
\end{enumerate}


Eine weit verbreitete Möglichkeit ist das Einbinden von bereits existierenden Bibliotheken, die viele Funktionalitäten von Haus aus anbieten. Eine eigene Nachbildung von verbreiteten Algorithmen aus dem Bereich Maschinelles Lernen ist daher meist nicht nötig.\\
Eine zweite Möglichkeit ist die Integration von R. Bei R handelt es sich um eine eigene Programmiersprache, welche den Schwerpunkt in mathematischen Problemlösungen hat. Python und R lassen sich beide sowohl eigenständig, also auch in Verbindung miteinander einsetzen.

Im Folgenden Abschnitt gibt es eine Übersicht, über wichtige und bekannte Bibliotheken aus dem Bereich maschinelles Lernen. Die Anzahl der Bibliotheken macht den Einstieg nicht ganz leicht. Die Stärken und Schwächen der einzelnen Bibliotheken sollten betrachtet werden. 


\subsection{Bibliotheken}\label{maschinelleslernen:bibliotheken}
Im Bereich maschinelles Lernen sind schon viele Bibliotheken vorhanden, die unterschiedliche Schwerpunkte in dem Bereich bedienen. Aus diesem Grund erfolgt zuerst eine Übersicht über verbreitete Bibliotheken.

Alle Bibliotheken\randnotiz{Download und Installation} die genutzt werden sollen müssen zuerst installiert werden. Hierfür gibt es je nach Bibliothek und teilweise je nach Betriebssystem mehrere Wege. Es wird empfohlen hier aus der jeweiligen Webseite die geeignetsten Variante zu wählen und auszuführen.

Nach der Installation\randnotiz{Versionen und Kompatibilität} sollten alle Versionen ausgelesen und abgeglichen werden. Die Kompatibilität ist nicht durchgehend gewährleistet, das betrifft vor allem die unterschiedlichen Python-Versionen.

Der folgende Codeausschnitt zeigt ein Beispiel. Dieser kann entweder direkt in der Eingabeaufforderung bzw. Konsole nach Start von Python ausgeführt werden oder innerhalb einer geeigneten Entwicklungsumgebung.

\begin{lstlisting}
# Python version
import sys
print("Pyton: {}".format(sys.version))

# numpy version
import numpy
print("numpy: {}".format(numpy.__version__))

# pandas version
import pandas
print("pandas: {}".format(pandas.__version__))

# rpy2 version
import rpy2
print("rpy2: {}".format(rpy2.__version__))
\end{lstlisting}\label{maschinelleslernen:lst:printversions}

Die Ausgabe ist beispielsweise die Folgende:
\begin{lstlisting}
Pyton: 3.6.1 (v3.6.1:69c0db5, Mar 21 2017, 17:54:52) 
	[MSC v.1900 32 bit (Intel)]

numpy: 1.13.3 
pandas: 0.21.0
rpy2: 2.8.6
\end{lstlisting}\label{maschinelleslernen:lst:versions}

Auf diese Art und Weise sollten alle Bibliotheken geprüft werden, da so eventuelle Kompatibilitätsprobleme oder fehlerhafte Installation frühzeitig erkannt werden können.

\subsubsection{Bekannte Bibliotheken}\label{maschinelleslernen:bekanntebibliotheken}
Grob kann man zwischen Datenanalyse und Visualisierung unterscheiden. Zwei bekannte Bibliotheken aus dem Bereich Datenanalyse sind \textit{numpy} und \textit{pandas}, mit denen beispielsweise Gleichungen und Optimierungsprobleme gelöst werden können. Ergebnisse solcher Berechnungen können beispielsweise mithilfe des Moduls \textit{matplotlib} visualisiert werden.~\cite{Python3}



In der Bibliothek \textit{numpy}~\cite{numpyreference} \randnotiz{numpy} wird ein flexibler Datentyp für mehrdimensionale Arrays zur Verfügung gestellt. Dies ermöglicht eine effiziente Durchführung von komplexen Rechnungen.

Außerdem lassen sich Integrale berechnen, statistische Berechnungen durchführen und auch simulieren. All das wird für maschinelles Lernen benötigt. Da die Berechnungen mit Routinen nah an der Hardware durchgeführt werden, lassen sich bei entsprechender Programmierung effiziente Programme schreiben.

Die Arrays in \textit{numpy} sind dreidimensional und können so eine Vielzahl von Anwendungsfällen abbilden. Der Fokus von \textit{numpy} liegt in der Datenhaltung und Manipulation von Daten. Hier speziell die numerische Manipulation aus dem Bereich der linearen Algebra. Mit den Matrizen können beispielsweise Multiplikationen und Dekompositionen durchgeführt werden. Aus diesem Grund sind \textit{numpy}-Array oft die Datenstruktur, mit der weiterführende Bibliotheken arbeiten können.



Die Webseite zu \textit{pandas}~\cite{pandas} \randnotiz{pandas} beschreibt dieses als gute Wahl zur schnellen und flexiblen Aufbereitung von Daten. \textit{pandas} bietet verschiedene Möglichkeiten, um schnell auf Einträge zuzugreifen. Dies ist möglich, da mittels \textit{pandas} Serien und Dataframes erzeugt werden können, die im Gegensatz zu einem Array in Python auch Spaltentitel und Indizes anbieten.

Die \textit{describe()}-Methode bietet hierbei einen ersten Überblick über die im Dataframe enthalten Daten. Ohne weitere Programmierung werden Informationen wie Maximalwert, Minimalwert und Durchschnitt für jede Spalte berechnet und angezeigt. 

Spalten und Zeilen können mittels \textit{pandas} gefiltert, erweitert und verändert werden, sodass Pandas oft im ersten Schritt genutzt wird, um die auszuwertenden Daten zu laden und genauer analysieren zu können.


Ergänzend bzw. aufbauen auf \textit{numpy} \randnotiz{scipy} werden durch \textit{scipy}~\cite{scipyreference} viele mathematische Operationen bereit gestellt. 
Das Modul \textit{scipy} ist sehr mächtig und daher nochmal in Untermodule aufgeteilt. Innerhalb der Untermodule werden bestimmte Funktionalitäten gruppiert. Eine Übersicht hierzu gibt die Onlinedokumentation.



Viele DataMining \randnotiz{scikit-learn} bzw. Machine Learning Funktionalitäten werden bereits durch die \textit{scikit-learn}~\cite{scikit} Bibliothek (manchmal aus sklearn abgekürzt) zur Verfügung gestellt. Die klassischen Algorithmen, wie \textit{k-Means} oder \textit{knn} sind bereits integriert.\\
Des Weiteren ist auch mit \textit{scikit-learn} eine Aufbereitung der Daten möglich. Hier werden beispielsweise Normalierung und Skalierung unterstützt. Insgesamt handelt es sich um eine sehr mächtige Bibliothek, mit der es möglich ist unterschiedliche Algorithmen zu probieren und verschiedene Test- und Trainingsverfahren zu testen. Es können auch neue Daten anhand der gelernten Modelle klassifiziert und vorhergesagt werden.



Eine weitere Möglichkeit ist das Einbinden des Pakets \textit{rpy2}~\cite{rpy2} \randnotiz{rpy2}. Hierbei handelt es sich um eine Bibliothek, welche Komponenten aus R zur Verfügung stellt. \textit{rpy2} ist zu sehen wie eine Schnittstelle zwischen Python und R. Es ist möglich R-Pakete mittels Python zu importieren und mit den darin enthaltenen Funktionalitäten zu interagieren.



Mit dem Modul \textit{matplotlib}~\cite{matplotlib} \randnotiz{matplotlib} können Daten in einem Diagramm dargestellt werden. Hiermit kann ein erstes Verständnis der Daten oder Ergebnisse erreicht werden. Es werden unter anderem Liniendiagramme, Histogramme, Balkendiagramme aber auch Heatmaps unterstützt. Hier können sowohl Achsen, Farben und auch Beschriftungen nach Bedarf angepasst werden. \textit{matplotlib} unterstützt sowohl \textit{pandas} als auch \textit{numpy} und ist daher oft bereits am Anfang von hoher Bedeutung, um einen Überblick über die Daten zu bekommen.


\uebung
\aufgabe{machinelearning1}


\subsection{Einfache Anwendungsbeispiele}\label{maschinelleslernen:anwendungsbeispiele}
Es gibt verschiedene Herangehensweisen, meist bietet es sich an, erst mal einen groben Überblick über die Daten zu erhalten. Für die erste Erläuterung werden Datensätze angenommen, welche in folgender Datenstruktur vorliegen.

\subsubsection*{Daten aus Datei lesen und anzeigen}
Maschinelles Lernen \randnotiz{Beispieldaten} macht nur Sinn mit entsprechenden Daten. Diese sollten im Besten Fall bereits in einer strukturierten Form vorliegen.
\lstinputlisting[language=Python]{chapters/advancedTopics/src/machinelearning/datasample1.txt}\label{datasample1:lst:datasample}


Nun kann mit der Entwicklung begonnen werden. Um den Datentyp \randnotiz{Datei lesen} mit Daten zu versorgen findet sich im Folgenden ein kleiner Codeausschnitt:
\lstinputlisting{chapters/advancedTopics/src/machinelearning/readdatafromfile.py}\label{readdatafromfile:lst:readdata}

Die aufbereiteten Daten können im nächsten Schritt visualisiert werden. Vorher noch eine weitere Variante wie Daten geladen werden können.

\subsubsection*{Daten aus Paket laden}
Eine\randnotiz{iris-Dataset laden} weitere Möglichkeit ist das Laden von Daten aus Paketen. Hier wird beispielhaft das Lesen aus dem Paket \lstinline$iris$ vorgestellt.
\lstinputlisting[language=Python,firstline=3,lastline=19]{chapters/advancedTopics/src/machinelearning/loadiris.py}\label{loadiris:lst:loadiris}

Nun kann es an die Darstellung der Daten gehen.

\subsubsection*{Plots erzeugen}
Aus den oben gelesen Daten kann nun ein Plot erzeugt werden. Für das Beispiel oben bietet sich die Darstellung in einem Scatterplot an.


\randnotiz{Plot erzeugen}\lstinputlisting[language=Python]{chapters/advancedTopics/src/machinelearning/defineplot1.py}\label{defineplot1:lst:2dplot}

Eine Darstellung in 3D ist ebenfalls möglich. Hierzu wird aus dem DataSet noch eine dritte Dimension ausgelesen.

\randnotiz{3 Achsen}\lstinputlisting[language=Python]{chapters/advancedTopics/src/machinelearning/defineplot2.py}\label{defineplot2:lst:3dplot}


\subsection{knn-Klassifikation}\label{maschinelleslernen:knnklassifikation}
Der knn-Algorithmus ist einer der bekanntesten Algorithmus aus dem Bereich Klassifikation und wird daher hier als Codebeispiel dargestellt und erläutert.

Folgende Imports\randnotiz{Imports} sind nötig:
\lstinputlisting[language=Python,firstline=4,lastline=11]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample4}

Anschließend können die Daten\randnotiz{Daten laden} geladen und die Spaltennamen definiert werden.
\lstinputlisting[language=Python,firstline=14,lastline=20]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample14}

Jetzt werden die Daten gelesen\randnotiz{Daten lesen und vorbereiten} und vorbereitet.
\lstinputlisting[language=Python,firstline=22,lastline=28]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample22}

Zur Berechnung müssen die Daten\randnotiz{Daten skalieren} skaliert werden.
\lstinputlisting[language=Python,firstline=33,lastline=37]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample33}

Nun kann der KNN-Algorithmus\randnotiz{Algorithmus anwenden} angewendet werden.
\lstinputlisting[language=Python,firstline=39,lastline=44]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample39}

Jetzt können wir die Daten-Matrix\randnotiz{Matrix ausgeben} ausgeben.
\lstinputlisting[language=Python,firstline=46,lastline=47]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample46}

Als Ausgabe wird Folgendes angezeigt
\begin{lstlisting}
[[ 9  0  0]
 [ 0 12  1]
 [ 0  1  7]]
\end{lstlisting} 
 
Zusätzlich\randnotiz{Report ausgeben} kann ein Report angezeigt werden, welcher eine gute Übersicht über die klassifizierten Daten gibt.
\lstinputlisting[language=Python,firstline=48,lastline=49]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample49}

Die Ausgabe ist die folgende:
\begin{lstlisting} 
                  precision    recall  f1-score   support
 
     Iris-setosa       1.00      1.00      1.00         9
 Iris-versicolor       0.92      0.92      0.92        13
  Iris-virginica       0.88      0.88      0.88         8
 
       micro avg       0.93      0.93      0.93        30
       macro avg       0.93      0.93      0.93        30
    weighted avg       0.93      0.93      0.93        30
\end{lstlisting}



Um \randnotiz{Fehler ausgeben}ein abschließendes Bild über die Klassifikation zu erhalten können nun noch die Fehler ausgegeben werden.
\lstinputlisting[language=Python,firstline=51,lastline=61]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample51}


Aus\randnotiz{Fehler-Plot erzeugen} den berechneten Klassifikationsfehlern kann nun noch ein Plot erzeugt werden.
\lstinputlisting[language=Python,firstline=64,lastline=72]{chapters/advancedTopics/src/machinelearning/knnsample.py}\label{knnsample:lst:knnsample64}

\begin{figure}[ht]
	\centering
	\includegraphics[width=1\textwidth]{images/PlotKNN.png}
	\caption{Ergebnis-Plot der Fehler nach Ausführung KNN}
	\label{ml:samples:plotknn}
\end{figure}

\subsection{Naive Bayes}\label{maschinelleslernen:naivebayes}
Ein weiteres Beispiel aus dem Bereich Klassifikation im maschinellen Lernen ist der Naive Bayes Algorithmus.

Es \randnotiz{Importe}sind wieder einige Importe nötig.
\lstinputlisting[language=Python,firstline=3,lastline=5]{chapters/advancedTopics/src/machinelearning/bayessample.py}\label{knnsample:lst:bayessample3}

Die \randnotiz{Daten laden}Beispieldaten müssen definiert werden.
\lstinputlisting[language=Python,firstline=7,lastline=11]{chapters/advancedTopics/src/machinelearning/bayessample.py}\label{knnsample:lst:bayessample7}

Nun kann das Modell erzeugt werden um mit den Daten zu trainieren. Anschließend können die Daten vorhergesagt und die Ergebnisse anzeigt werden.
\lstinputlisting[language=Python,firstline=13,lastline=21]{chapters/advancedTopics/src/machinelearning/bayessample.py}\label{knnsample:lst:bayessample13}

Die Ausgabe lautet:
\begin{lstlisting}
[3 4]
\end{lstlisting}

\subsection{Lineare Regression}\label{maschinelleslernen:linregress}
Beispiel aus dem Bereich Regression. Konkret wird hier eine lineare Regression dargestellt. 

Es \randnotiz{Importe}sind verschiedene Importe für nötig. Die werden im ersten Schritt importiert.
\lstinputlisting[language=Python,firstline=1,lastline=5]{chapters/advancedTopics/src/machinelearning/linregress.py}\label{knnsample:lst:lingress1}

Daten \randnotiz{Daten laden}aus boston-Datensatz auslesen und in numpy-array überführen.
\lstinputlisting[language=Python,firstline=7,lastline=10]{chapters/advancedTopics/src/machinelearning/linregress.py}\label{knnsample:lst:lingress7}

Die \randnotiz{Berechnung durchführen}Berechnung der linearen Regression kann direkt aus dem scipy-Paket erfolgen. Die nötigen Daten müssen mitgegeben werden.
\lstinputlisting[language=Python,firstline=12,lastline=13]{chapters/advancedTopics/src/machinelearning/linregress.py}\label{knnsample:lst:lingress12}

Nun \randnotiz{Plot erzeugen}kann der Plot für die berechneten Werte erzeugt werden.
\lstinputlisting[language=Python,firstline=15,lastline=27]{chapters/advancedTopics/src/machinelearning/linregress.py}\label{knnsample:lst:lingress15}


\begin{figure}[ht]
	\centering
	\includegraphics[width=0.9\textwidth]{images/PlotLinRegress.png}
	\caption{Ergebnis-Plot der linearen Regression}
	\label{ml:samples:plotlinregress}
\end{figure}


\uebung
\aufgabe{machinelearning2}